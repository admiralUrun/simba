@import helper._
@import services.SimbaHTMLHelper._
@import java.util.Date
@(orders:Map[Date, List[PlayOrderForDisplay]], search:String)(implicit request: MessagesRequestHeader)

    @getDateRow(d: Date) = {
        <tr>
            <tb>
                <h4>@formattingDateForDisplay(d)</h4>
            </tb>
        </tr>
    }

    @getCustomerDataForView(c: Customer) = @{
        def getSecondPhoneOrCloseBrace: String = if(c.phone2.nonEmpty)s", ${c.phone2})" else ")"
        s"${c.id}- ${c.firstName} ${c.lastName} (${c.phone}" + getSecondPhoneOrCloseBrace
    }

    @getAddressForView(a: Address) = @{
        s"Місто: ${a.city}, Адреса: ${a.address}, Під'їзд: ${getStringOrDash(a.entrance)}, Поверх: ${getStringOrDash(a.floor)}, Квартира: ${getStringOrDash(a.flat)}"
    }


    @formatBoolean(b:Boolean, trueLabel: String, falseLabel: String) = @{
        if(b) trueLabel else falseLabel
    }
@main("Замовлення") {

    @getFlash()

    <div class="container-fluid">
        <div class="row">
            @form(routes.OrderController.toOrderFeedPage(""), Symbol("class") -> "colFirst") {
                <input name="search" type="search" value="@search">
                <input type="submit" id="searchSubmit" value="Пошук" class="btn btn-primary">
            }
            <div class="col"></div>
            <a class="colLast btn btn-success" id="add" href="@routes.OrderController.toOrderCreatePage()">Додати</a>
        </div>
    </div>

    @getDateRow(new Date())
    <div id="table">
    @if(orders.nonEmpty) {
        <table class="table table-striped table-bordered">
            <thead>
                <tr>@tableHeaders(List("id", "Замовник", "Адреса", "Дата Замовлення", "Дата Доставки", "Сума", "Оплата", "Статус", "Нотатка"))</tr>
            </thead>
            <tbody>
            @orders.map { t =>
                @getDateRow(t._1)
              @t._2.map{ o =>
                  <tr>
                      <tb>@o.id</tb>
                      <td>@getCustomerDataForView(o.customer)</td>
                      <td>@getAddressForView(o.address)</td>
                      <tb>@formattingDateForDisplay(o.orderDay)</tb>
                      <tb>@formattingDateForDisplay(o.deliveryDay)</tb>
                      <tb>@o.inOrder</tb>
                      <tb>@o.total</tb>
                      <tb>@formatBoolean(o.paid, "Оплаченно", "Не оплаченно")</tb>
                      <tb>@formatBoolean(o.delivered, "Доставленно", "Не Доставленно")</tb>
                      <tb>@o.note</tb>
                  </tr>
              }
            }
            </tbody>
        </table>
    } else {
        <h4 class="alert-info">Як там бізнес?, мяу</h4>
    }
    </div>
}