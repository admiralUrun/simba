@import java.util.Date
@(orders:Map[Date, List[PlayOrderForDisplay]], search:String)(implicit request: MessagesRequestHeader)
@import helper._
    @header() = {
        @List("id", "Замовник", "Адреса", "Дата Замовлення", "Дата Доставки", "Сума", "Оплата", "Статус", "Нотатка").zipWithIndex.map{ case (header, i) =>
        <th class="col@{i + 1} header">
            @header
        </th>
    }
}
    @getFlashes = {
        @request.flash.get("success").map { message =>
        <div class="alert-success">
            <strong>Готово!</strong> @message
        </div>
        }
        @request.flash.get("error").map { message =>
        <div class="alert-danger">
            <strong>@message</strong>
        </div>
        }
    }

    @formatingDate(d:Date) = @{
        val monthsTranslate = Map(
            "Jan" -> "Січень",
            "Feb" -> "Лютий",
            "Mar" -> "Березень",
            "Apr" -> "Квітень",
            "May" -> "Травень",
            "Jun" -> "Червень",
            "Jul" -> "Липень",
            "Aug" -> "Серпень",
            "Sep" -> "Вересень",
            "Oct" -> "Жовтень",
            "Nov" -> "Листопад",
            "Dec" -> "Грудень",
        )
        val weekDayTranslate = Map(
            "Mon" -> "Понеділок",
            "Tue" -> "Вівторок",
            "Wed" -> "Середа",
            "Thu" -> "Четверг",
            "Fri" -> "П'ятниця",
            "Sat" -> "Суббота",
            "Sun" -> "Неділя"
        )
        val dateArray = d.toString.split(" ")
        weekDayTranslate(dateArray(0)) + " " + dateArray(2) + " " + monthsTranslate(dateArray(1)) + " " + dateArray(5)
    }

    @getDateRow(d: Date) = {
        <tr>
            <tb>
                <h4>@formatingDate(d)</h4>
            </tb>
        </tr>
    }

    @getCustomerDataForView(c: Customer) = @{
        def getSecondPhoneOrCloseBrace: String = if(c.phone2.nonEmpty)s", ${c.phone2})" else ")"
        s"${c.id}- ${c.firstName} ${c.lastName} (${c.phone}" + getSecondPhoneOrCloseBrace
    }

    @getCustomerAddressForView(c: Customer) = @{
        def formatString(o: Option[String], n: Option[String]) = {
            o.map(p => p + n.map(n => s"($n)").getOrElse("")).getOrElse("")
        }
        s"${c.city} ${c.address} ${formatString(c.entrance, Option("Під'їзд"))} ${formatString(c.floor, Option("Поверх"))} ${formatString(c.flat, Option("Квартира"))}"
    }


    @formatBoolean(b:Boolean, trueLabel: String, falseLabel: String) = @{ // TODO maybe add custom classes
        if(b) trueLabel else falseLabel
    }
@main("Замовлення") {

    @getFlashes

    <div class="container-fluid">
        <div class="row">
            @form(routes.OrderController.toOrderListPage(""), Symbol("class") -> "colFirst") {
                <input name="search" type="search" value="@search">
                <input type="submit" id="searchSubmit" value="Пошук" class="btn btn-primary">
            }
            <div class="col"></div>
            <a class="colLast btn btn-success" id="add" href="@routes.CustomerController.toCreateCustomerPage()">Додати</a>
        </div>
    </div>

    @getDateRow(new Date())
    <div id="table">
    @if(orders.nonEmpty) {
        <table class="table table-striped table-bordered">
            <thead>
                <tr>@header()</tr>
            </thead>
            <tbody>
            @orders.map { t =>
                @getDateRow(t._1)
              @t._2.map{ o =>
                  <tr>
                      <tb>@o.id</tb>
                      <td>@getCustomerDataForView(o.customer)</td>
                      <td>@getCustomerAddressForView(o.customer)</td>
                      <tb>@formatingDate(o.orderDay)</tb>
                      <tb>@formatingDate(o.deliveryDay)</tb>
                      <tb>@o.inOrder</tb>
                      <tb>@o.total</tb>
                      <tb>@formatBoolean(o.paid, "Оплаченно", "Не оплаченно")</tb>
                      <tb>@formatBoolean(o.delivered, "Доставленно", "Не Доставленно")</tb>
                      <tb>@o.note</tb>
                  </tr>
              }
            }
            </tbody>
        </table>
    } else {
        <h4 class="alert-info">Як там бізнес?, мяу</h4>
    }
    </div>
}