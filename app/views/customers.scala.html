@(customers: Seq[Customer], search: String)(implicit request: MessagesRequestHeader)
@import helper._

@header() = {
    @List("ID", "Ім'я", "Прізвище", "Телефон", "Телефон 2",
        "Місто", "Адреса", "Instagram", "Надає перевагу", "Нотатка").zipWithIndex.map{ case (header, i) =>
            <th class="col@{i + 1} header">
                @header
            </th>
    }
}
@*TODO: refactor this*@
@adrressBuilder(name: String, variable: Option[String], comaInTheEnd: Boolean = true) = {
    @if(variable.nonEmpty) {
        @{
         val full = name + ": " + variable.get
         if(comaInTheEnd) full + "," else full
        }
    } else {}
}

@formatPhone(phone: Option[String], note: Option[String]) = @{
    phone.map(p => p + note.map(n => s" ($n)").getOrElse("")).getOrElse("-")
}

@main("Клієнти") {

    @request.flash.get("success").map { message =>
        <div class="alert-success">
            <strong>Готово!</strong> @message
        </div>
    }
    @request.flash.get("error").map { message =>
        <div class="alert-danger">
            <strong>@message</strong>
        </div>
    }

    <div class="container-fluid">
        <div class="row">
            @form(routes.CustomerController.toCustomersListPage(""), Symbol("class") -> "colFirst") {
                <input type="search" name="search" value="@search">
                <input type="submit" id="searchSubmit" value="Пошук" class="btn btn-primary">
            }
            <div class="col"></div>
            <a class="colLast btn btn-success" id="add" href="@routes.CustomerController.toCreateCustomerPage()">Додати</a>
        </div>
    </div>

    <div id="table">
        @if(customers.nonEmpty) {
        <table class="table table-striped table-bordered">
            <thead>
                <tr>@header()</tr>
            </thead>
            <tbody>
            @customers.map { c =>
                <tr>
                    <td><a href="@routes.CustomerController.toEditCustomerPage(c.id.head)">@c.id</a></td>
                    <td>@c.firstName</td>
                    <td>@c.lastName.getOrElse("-")</td>
                    <td>@formatPhone(Option(c.phone), c.phoneNote)</td>
                    <td>@formatPhone(c.phone2, c.phoneNote2)</td>
                    <td>@c.city</td>
                    <td>
                        @c.address,
                        @adrressBuilder("Під'їзд", c.entrance)
                        @adrressBuilder("Поверх", c.floor)
                        @adrressBuilder("Квартира", c.flat, comaInTheEnd = false)
                    </td>
                    <td>@c.instagram.getOrElse("-")</td>
                    <td>@c.preferences.getOrElse("-")</td>
                    <td>@c.notes.getOrElse("-")</td>
                </tr>
            }
            </tbody>
        </table>
    } else {
        <h4 class="alert-info">Нікого немає, мяу</h4>
    }
    </div>
}
