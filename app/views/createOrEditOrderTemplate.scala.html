@import java.util.Date
@import views.html.helper._
@import services.SimbaHTMLHelper._
@import models.OrderMenu
@import models.OrderMenuItem
@(title: String, formCall: Call, oF: Form[PlayOrderForEditAndCreate], buttonLabel: String, inMenu: List[OrderMenu], isCreate: Boolean = false, inOrderToTextCost: Map[String, (String, Int)] = Map())(implicit requestHeader: MessagesRequestHeader)

@createAMenuDropDown(menuTitle: String, inMenu: List[OrderMenuItem]) = {
    @if(inMenu.length == 1) {
        <button class="btn btn-info" type="button" onclick="addToOrder('@{inMenu.head.value}', '@{inMenu.head.name}', '@{inMenu.head.cost}')">@{inMenu.head.name}</button>
    } else {
    @createDropDown(menuTitle, inMenu, (i: OrderMenuItem) => {
        getStandardDropItem(i.name, JavaScript(s"addToOrder('${i.value}', '${i.name}', '${i.cost}')"))
    })
    }
}

@createInputInOrder = {
    <div class="container-fluid row">
        <input type="text" id="inOrder" name="inOrder" value="" class="col-1" style="display: none">
        <div class="container-fluid row">
            <ul class="list-group">
                @if(!isCreate) {
                    @oF("inOrder").value.get.split(",").zipWithIndex.map(t => addToDisplay(t._2, inOrderToTextCost(t._1)))
                } else {}
            </ul>
        </div>
        <div class="container-fluid row">
            @inMenu.map(menu => createAMenuDropDown(menu.title, menu.menuItems))
        </div>
    </div>
}
@addToDisplay(index: Int, textCost: (String, Int)) = {
    <li class="list-group-item" id="element@index"> @textCost._1 <button type="button" class="close" aria-label="Close" onclick="deleteFromOrder('@index', '@textCost._2')"><span aria-hidden="true">&times;</span></button></li>
}


@createBooleanInput(nameInForm:String, trueLabel:String, falseLabel:String, checked:Boolean = false, col:String = "auto", jsOnclick: JavaScript) = {
    <input id="@nameInForm" name="@nameInForm" value="@checked" style="display: none">
    @if(checked) {
        <button id="@nameInForm-button" class="btn col-@col btn-success" type="button" onclick="@jsOnclick">
            @trueLabel
        </button>
    } else {
        <button id="@nameInForm-button" class="btn col-@col btn-danger" type="button" onclick="@jsOnclick">
            @falseLabel
        </button>
    }
}
@main(title) {
    <div class="container-fluid">
        <div id="customerInformation" class="row">
            <form>
                <div id="searchDIV" class="input-group col-md"  style="display: ">
                    <input id="search" name="search" type="search" class="form-control dropdown-toggle col-auto" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <div id="searchMenu" class="dropdown-menu">
                        <span class="dropdown-header">Тут можна знайти Клієнта</span>
                    </div>
                    <input type="button" id="searchSubmit" value="Пошук" class="btn btn-primary offset-sm-1">
                </div>
            </form>
           <!-- <a class="colLast btn btn-success disabled" id="add" href="@routes.CustomerController.toCreateCustomerPage()">Додати</a> -->
        </div>
    </div>
    @form(formCall) {
        <fieldset>
            @CSRF.formField
            <div class="container-fluid row">
                <input id="customersID" name="customersID" style="display: none">
            </div>

            <input name="orderDay" type="text" value="@formattingDateForForm(new Date())" style="display: none">
            <input name="deliveryDay" type="text" value="@getNextSunday" style="display: none">

            <label class="label" for="dataInput">Час доставки </label>
            <div id="dataInput" class="container-fluid row">
                <input id="deliverFrom" name="deliverFrom" type="text" class=" col-auto">
                     <b class="col-auto"> По </b>
                <input id="deliverTo" name="deliverTo" type="text" class=" col-auto">
            </div>

            <input id="total" type="text" style="display: none;">
            <label>Всьго</label>
            <h5 id="totalText">0 ₴</h5>
            <div id="payment">
                <input id="paymentInput" type="text" style="display: none;">
                <div id="paymentMenu">
                    @createDropDown("Спосіб Оплати", List("Готівка", "Карткою", "Бартер"), (s: String) => { // TODO: Add to database remove hardCode
                        val id = "paymentItem"
                        getStandardDropItem(s, JavaScript(s"setPayment('x$s')"), id)
                    })
                </div>
            </div>

            <div class="container-fluid row">
                @createBooleanInput("paid", "Оплаченно", "Не оплаченно", getCheckBoxValue("paid" ,oF),
                    jsOnclick = JavaScript("changeButton(`Оплаченно`, `Не оплаченно`, `paid`, 0);")
                )
                @createBooleanInput("delivered", "Доставленно", "Не доставленно", getCheckBoxValue("delivered" ,oF),
                    jsOnclick = JavaScript("changeButton(`Доставленно`, `Не доставленно`, `delivered`, 0);")
                )
            </div>

            <div class="container-fluid row">
                @createBooleanInput("offlineDelivery", "За межами Доставки", "За межами Доставки", getCheckBoxValue("paid" ,oF),
                    jsOnclick = JavaScript("changeButton(`За межами Доставки`, `За межами Доставки`, `offlineDelivery`, 75);")
                )
                @createBooleanInput("deliveryOnMonday", "Доставка у Понеділок", "Доставка у Понеділок", getCheckBoxValue("delivered" ,oF),
                    jsOnclick = JavaScript("changeButton(`Доставка у Понеділок`, `Доставка у Понеділок`, `deliveryOnMonday`, 100);")
                )
            </div>

            @createInputInOrder

            <div class="form-group">
                <label for="note">Нотатка</label>
                <textarea class="form-control" id="note" name="note" rows="3">@insertNotes(oF.value)</textarea>
            </div>
        </fieldset>

        <div class="actions">
            <input type="submit" value="@buttonLabel" class="btn btn-primary"> Або
            <a href="@routes.OrderController.toOrderFeedPage("")" class="btn">Скасувати</a>
        </div>
    }
    <script id="runtimeScript">
        $(document).ready(function () {
            $("#search").keyup(
                function() {
                    let searchParams = $("#search").val()
                    if (searchParams.length === 0)  cleanDropMenu();
                    else {}
                });
            $("#searchSubmit").click(
                function() {
                    let searchParams = $("#search").val()
                    $.get("/searchCustomerForOrder?search=" + searchParams, function (data) { takeCustomerJSONAddToUI(data) })
                });
            // $("#paymentItem").click(
            // )
        })
    </script>

    <script charset="UTF-8" src="@routes.Assets.versioned("javascript/orderScript.js")"></script>
 @* <script charset="utf-8" type="text/javascript" src="@routes.HomeController.javascriptRoutes"></script> *@
}